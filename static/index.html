<!DOCTYPE html>
<html>
    <head>
            <link rel="stylesheet" type="text/css" href="stylesheets/main.css">
    </head>

    <body>
        <div id = "filters">
            <div id = "filterContainer">
                <div id="filterText">
                    Platform
                </div>
                <select>
                  <option value="volvo">Samsung J2</option>
                  <option value="saab">Saab</option>
                  <option value="mercedes">Mercedes</option>
                  <option value="audi">Audi</option>
                </select>
            </div>
            <div id = "filterContainer">
                <div id="filterText">
                    Operator
                </div>
                <select>
                  <option value="volvo">T-Mobile</option>
                  <option value="saab">Saab</option>
                  <option value="mercedes">Mercedes</option>
                  <option value="audi">Audi</option>
                </select>
            </div>
            <div id = "filterContainer">
                <div id="filterText">
                    Country
                </div>
                <select>
                  <option value="volvo">Afghanistan</option>
                  <option value="saab">Saab</option>
                  <option value="mercedes">Mercedes</option>
                  <option value="audi">Audi</option>
                </select>
            </div>
            <div id = "filterContainer">
                <div id="filterText">
                    Version
                </div>
                <select>
                  <option value="volvo">2.4</option>
                  <option value="saab">Saab</option>
                  <option value="mercedes">Mercedes</option>
                  <option value="audi">Audi</option>
                </select>
            </div>
        </div>

        <main>
            <div id ="appTray">
                <div id ="allicons">
                </div>
            </div>
        </main>

        <script>
        var cms_database
        fetch('cms-database.json').then(function(response) {
            if(response.ok)
            {
                response.json().then(function(json) {
                    cms_database = json;
                });
            }
            else
            {
                console.log('Network request for products.json failed with response ' + response.status + ': ' + response.statusText);
            }
        });




        // function main(cms_database)
        // {
        //     console.log(cms_database);
        //     for (var i = 0; i < cms_database.length; i++) {
        //         var webapps = cms_database[i].webapps
        //         console.log(webapps);
        //         for(var o= 0; o < webapps.length; o++){
        //             document.getElementById("allicons").innerHTML += ("<img id='icon' src='" + webapps[o].iconUrl +"' />");
        //         }
        //     }
        // }




        var xmlhttp = new XMLHttpRequest();
        var url = "/rest/allApps";

        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var allApps = JSON.parse(this.responseText);
                allAppsContainer = document.getElementById("allicons");
                showWebapps(allAppsContainer, allApps);
                console.log('Network request for allApps.json succeeded. JSON:');
                console.log(allApps);
            }
            else {
                console.log('Network request for allApps.json failed with response ' + this.status);
            }
        };
        xmlhttp.open("GET", url, true);
        xmlhttp.send();

        var webAppsHTML = "";
        function showWebapps(allAppsContainer, webapps) {

            for(var o= 0; o < webapps.length; o++){
                console.log("Adding "+webapps[o].name+" iconContainer to the HTML");
                webAppsHTML += "<div id='iconContainer'>";
                webAppsHTML += ("<img id='icon' src='" + webapps[o].iconUrl +"' />");
                webAppsHTML += ("<div id='iconText'>");
                webAppsHTML += (webapps[o].name + " Ultra");
                webAppsHTML += ("</div>");
                webAppsHTML += ("</div>");
            }

            webAppsHTML += "<div id='iconContainer'>";
            webAppsHTML += ("<img id='icon' src='" + "/images/add_icon.png" +"' />");
            webAppsHTML += ("<div id='iconText'>");
            webAppsHTML += ("Create new Ultra App");
            webAppsHTML += ("</div>");
            webAppsHTML += ("</div>");

            allAppsContainer.innerHTML = (webAppsHTML);
        }
        </script>
    </body>
</html>
